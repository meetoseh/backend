# sitemap_entries

This table is used primarily to determine the correct `lastmod` timestamp for
the sitemap generated by `frontend-ssr-web`. Rather than storing modification
times within the code, which would be complicated and error-prone, each page
rendered by `frontend-ssr-web` also exposes a component which contains the
significant content of the page (i.e., skips sitewide components). That is
then rendered serverside and hashed with sha512, encoded in base64url, and
stored here.

We then detect changes in that hash for determining `lastmod`.

Entries are updated while the sitemap is generated, but only deleted occassionally
via the background cleanup job `runners.cleanup_sitemap_entries`

## Fields

- `id (integer primary key)`: internal row identifier
- `uid (text unique not null)`: primary stable external row identifier;
  uses the [uid prefix](../uid_prefixes.md) `sme`
- `path (text unique not null)`: the external path for this component,
  e.g., `/shared/journeys/humming-bee-breath`
- `significant_content_sha512 (text not null)`: the SHA512 hash of the
  significant content on the page
- `created_at (real not null)`: when this record was created
- `updated_at (real not null)`: when this record was last updated; used for
  `lastmod`.

## Schema

```sql
CREATE TABLE sitemap_entries (
    id INTEGER PRIMARY KEY,
    uid TEXT UNIQUE NOT NULL,
    path TEXT UNIQUE NOT NULL,
    significant_content_sha512 TEXT NOT NULL,
    created_at REAL NOT NULL,
    updated_at REAL NOT NULL
);
```

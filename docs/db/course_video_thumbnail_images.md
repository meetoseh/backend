# course_video_thumbnail_images

The set of image files that were processed to be used as a thumbnail image
for a course video.

## Fields

- `id (integer primary key)`: Internal row identifier
- `uid (text unique not null)`: Primary stable external identifier. Uses the
  [uid prefix](../uid_prefixes.md) `cvt`
- `image_file_id (integer unique not null references image_files(id) on delete cascade)`: The image
  file with the appropriate exports
- `source (text not null)`: A JSON object which has a discriminatory `type` field,
  which has one of the following values:
  - `user`: The image was uploaded by a user. Additional fields:
    - `sub (str)`: the sub of the user who uploaded the image at the time the
      image was uploaded. This user may have since been deleted.
  - `frame`: The image was automatically generated by taking a frame from the video.
    Additional fields:
    - `frame_number (int)`: The frame number in the video that was used to generate
      the image
    - `video_sha512 (str)`: The sha512 of the video that was used to generate the
      image. This video may not have been kept, but if it is and hasn't since
      been deleted, this will correspond to the `original_sha512` on the
      corresponding `content_files` row.
- `last_uploaded_at (real not null)`: The last time this image was uploaded. Use
  the image files `created_at` for the first time. Used for sorting in admin. For
  auto-generated images, this is the last time the frame was taken.

## Schema

```sql
CREATE TABLE course_video_thumbnail_images (
    id INTEGER PRIMARY KEY,
    uid TEXT UNIQUE NOT NULL,
    image_file_id INTEGER UNIQUE NOT NULL REFERENCES image_files(id) ON DELETE CASCADE ON UPDATE RESTRICT,
    source TEXT NOT NULL,
    last_uploaded_at REAL NOT NULL
);

/* Implicit foreign key */
CREATE INDEX course_video_thumbnail_iamges_user_sub_idx ON course_video_thumbnail_images(json_extract(source, '$.sub')) WHERE json_extract(source, '$.type') = 'user';

/* Implicit foreign key */
CREATE INDEX course_video_thumbnail_iamges_video_sha512_idx ON course_video_thumbnail_images(json_extract(source, '$.video_sha512')) WHERE json_extract(source, '$.type') = 'frame';

/* Sort */
CREATE INDEX course_video_thumbnail_images_last_uploaded_at_idx ON course_video_thumbnail_images(last_uploaded_at);
```
